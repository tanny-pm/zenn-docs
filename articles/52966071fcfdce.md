---
title: "pecoã‚’æ´»ç”¨ã—ã¦zshã§ã®AWSãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆã‚’åŠ¹ç‡åŒ–ã™ã‚‹"
emoji: "ğŸª–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [zsh, aws, peco]
published: true
---

ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã®pecoã‚’æ´»ç”¨ã—ã¦ã€zshã§ã®AWSãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ‡ã‚Šæ›¿ãˆã‚’åŠ¹ç‡åŒ–ã—ã¾ã—ãŸã€‚

# èƒŒæ™¯ã¨èª²é¡Œ

AWS CLIã§ã¯ã€`credentials`ãƒ•ã‚¡ã‚¤ãƒ«ã«è¤‡æ•°ã®åå‰ä»˜ããƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã§ãã¾ã™ã€‚

```toml:~/.aws/credentials
[default]
aws_access_key_id=EXAMPLE
aws_secret_access_key=EXAMPLEKEY
[user1]
...
[user2]
...
[user3]
...
```

ã“ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ãã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ã‹ã€ã‚³ãƒãƒ³ãƒ‰ã«`--profile`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚

```sh
$ export AWS_PROFILE=user1
ã¾ãŸã¯
$ aws ec2 describe-instances --profile user1
```

è¤‡æ•°ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ‡ã‚Šæ›¿ãˆãªãŒã‚‰ä½œæ¥­ã™ã‚‹å ´åˆã€zshã®è£œå®ŒãŒåŠ¹ã„ãŸã¨ã—ã¦ã‚‚ã€åˆ‡ã‚Šæ›¿ãˆãŒå°‘ã—é¢å€’ã§ã™ã€‚


# ã‚´ãƒ¼ãƒ«

ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã®[peco](https://github.com/peco/peco)ã‚’æ´»ç”¨ã—ã¦ã€AWSãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«é¸æŠã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/d3cd297fd183-20240824.png)
*pecoã®å‹•ä½œã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚ä¸Šä¸‹ã‚­ãƒ¼ã§ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã§ãã‚‹*


# è¨­å®šæ–¹æ³•

## ç’°å¢ƒ

- zshã«pecoã‚’å°å…¥æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã€‚
  - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯[ã“ã¡ã‚‰ã®è¨˜äº‹](https://zenn.dev/obregonia1/articles/e82868e8f66793)ãŒè©³ã—ã„ã§ã™ã€‚
- AWSãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’`credentials`ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã€‚
  - è¨­å®šæ–¹æ³•ã¯[AWSå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/cli-configure-quickstart.html)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## æ‰‹é †

`aws configure list-profiles`ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ä¸€è¦§è¡¨ç¤ºã§ãã¾ã™ã€‚

```sh
$ aws configure list-profiles
default
user1
user2
user3
```

ã“ã‚Œã‚’ãƒ‘ã‚¤ãƒ—ã§pecoã«æ¸¡ã™ã¨ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«é¸æŠã§ãã¾ã™ã€‚

```sh
$ aws configure list-profiles | peco
QUERY> user          ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€IgnoreCase [3 (1/1)]
user1
user2
user3
```

ã“ã®ä»•çµ„ã¿ã‚’åˆ©ç”¨ã—ã¦ã€é¸æŠã—ãŸãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚`~/.zshrc`ã«ä»¥ä¸‹ã®ã‚ˆã†ãªè¨­å®šã‚’è¿½åŠ ã—ã¾ã™ã€‚

```sh:.zshrc
# aws profileã®è£œå®Œ
function peco-aws () {
  local selected_profile=$(aws configure list-profiles | peco --query "$LBUFFER")
  if [ -n "$selected_profile" ]; then
    BUFFER="export AWS_PROFILE=${selected_profile} export RPROMPT=AWS:${selected_profile}"
    zle accept-line
  fi
  zle clear-screen
}
zle -N peco-aws
bindkey '^g^a' peco-aws
```

ã“ã‚Œã§ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã§`Ctrl+GA`ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã§pecoã‚’èµ·å‹•ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚é¸æŠä¸­ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¡¨ç¤ºã•ã›ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/f61ed2d5f8e1-20240824.png)
*ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ãŸå¾Œã®ç”»é¢*


ãŸã ã€`aws configure list-profiles`ã®å®Ÿè¡Œã«æ•°ç§’ç¨‹åº¦ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã€pecoã®å®Ÿè¡Œã«ã‚¿ã‚¤ãƒ ãƒ©ã‚°ãŒç”Ÿã˜ã¦ã—ã¾ã†ã®ãŒé›£ç‚¹ã§ã™ã€‚

# ãŠã¾ã‘

AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã§ã‚¹ã‚¤ãƒƒãƒãƒ­ãƒ¼ãƒ«ã™ã‚‹éš›ã¯ã€Chromeæ‹¡å¼µã‚’ä½¿ã£ã¦åˆ‡ã‚Šæ›¿ãˆã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã“ã¡ã‚‰ã‚‚ã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚

https://oji-cloud.net/2021/02/10/post-5968/

# å‚è€ƒæ–‡çŒ®

https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/cli-configure-profiles.html

https://qiita.com/reireias/items/fd96d67ccf1fdffb24ed

https://www.wakuwakubank.com/posts/862-mac-zsh-peco/#index_id5
